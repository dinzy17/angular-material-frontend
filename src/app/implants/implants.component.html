<style> .resize-bar{ color: blue !important; }</style>

<div class="main-content implant--container">
  <div class="container-fluid">
      <div class="row">
          <div class="col-md-12">
              <div class="card">
                  <div class="card-header card-header-danger">
                      <h4 class="card-title">Implants</h4>
                  </div>
                  <div class="card-body">
                      <span>Fields marked with the asterisk (*) are mandatory</span>
                      <form class="form mat-form-field-wrapper" [formGroup]="form" (ngSubmit)="saveImplant(form.value)" #implantForm="ngForm" action="#">
                        <div class="row">
                            <div class="col-md-6">
                                    <div class="row">
                                        <div class="col-md-12">
                                            <div class="form-group">
                                                <mat-form-field class="example--full--width mat-headline">
                                                    <input matInput placeholder="* Implant manufacture" class="capitalize" formControlName="implantManufacture" [(ngModel)]="searchByString" (keyup)="filterManufacture()" name="implantManufacture" [matAutocomplete] = "auto" >
                                                    <mat-error class="error--handing"
                                                        *ngIf="form.controls['implantManufacture'].hasError('required') && (form.controls['implantManufacture'].dirty || form.controls['implantManufacture'].touched)">
                                                        {{ "The implant's manufactuerer name cannot be blank ." }}
                                                    </mat-error>
                                                    <mat-error class="error--handing"
                                                        *ngIf="form.controls['implantManufacture'].hasError('maxlength') && (form.controls['implantManufacture'].dirty || form.controls['implantManufacture'].touched)">
                                                        {{ "The implant's manufactuerer name cannot be greater than 150 characters." }}
                                                    </mat-error>
                                                    <mat-error class="error--handing" *ngIf="form.controls['implantManufacture'].hasError('manufacturerValidate') && (form.controls['implantManufacture'].dirty || form.controls['implantManufacture'].touched)">
                                                        {{ "Manufacture is already registerd." }}
                                                    </mat-error>
                                                    <mat-autocomplete #auto = "matAutocomplete"  #MatAutocompleteTrigger >
                                                        <mat-option *ngFor="let option of filteredOptions" [value]="option.implantManufacture">
                                                            {{ option.implantManufacture }}
                                                        </mat-option>
                                                    </mat-autocomplete>
                                                </mat-form-field>
                                            </div>
                                        </div>
                                        <div class="col-md-12">
                                            <div class="form-group">
                                                <mat-form-field class="example--full--width mat-headline">
                                                    <input matInput placeholder="* Implant name/brand" class="capitalize" formControlName="label" name="label" [matAutocomplete]="autoName" [(ngModel)]="searchName" (keyup)="filterName()" >
                                                    <mat-error class="error--handing"
                                                        *ngIf="form.controls['label'].hasError('required') && (form.controls['label'].dirty || form.controls['label'].touched)">
                                                        {{ "The implant's name/brand cannot be blank " }}
                                                    </mat-error>
                                                    <mat-error class="error--handing"
                                                        *ngIf="form.controls['label'].hasError('maxlength') && (form.controls['label'].dirty || form.controls['label'].touched)">
                                                        {{ "The implant's name/brand cannot be greater than 150 characters." }}
                                                    </mat-error>
                                                    
                                                    <mat-autocomplete #autoName="matAutocomplete">
                                                        <mat-option class="autocomplete--option" *ngFor="let name of filteredNames" [value]="name.objectName" >
                                                            <img class="example-option-img" aria-hidden [src]="name.imgName" height="25">
                                                            <span>{{name.objectName}}</span>
                                                        </mat-option>
                                                    </mat-autocomplete>
                                                    </mat-form-field>
                                                </div>
                                        </div>
                                    </div>
                                    <div class="row" >
                                            <div class="col-md-12">
                                                <div formArrayName="removalSection">
                                                    <div class="removal--process" *ngFor="let unit of form.controls.removalSection.controls; let i=index">
                                                        <div [formGroupName]="i">
                                                            <mat-icon class="icon--delete cursor--pointer" (click)="delete(i);" *ngIf="i > 0" >delete</mat-icon>
                                                            <mat-error class="error--handing custome-error"
                                                                *ngIf="(removaProcessError[i] !==undefined && removaProcessError[i])">
                                                                {{ "If you fill one field of this section. You need to fill all field." }}
                                                            </mat-error>
                                                            <div class="row form-group">
                                                                <div class="col-lg-12">
                                                                    <mat-form-field class="example--full--width mat-headline">
                                                                    <textarea matInput placeholder=" Removal Process" formControlName="removalProcess" name="removalProcess" cdkTextareaAutosize
                                                                    #autosize="cdkTextareaAutosize"
                                                                    cdkAutosizeMinRows="5"
                                                                    cdkAutosizeMaxRows="5" *ngIf = "i > 0" ></textarea>
                                                                    <textarea matInput placeholder="* Removal Process" formControlName="removalProcess" name="removalProcess" cdkTextareaAutosize
                                                                    #autosize="cdkTextareaAutosize"
                                                                    cdkAutosizeMinRows="5"
                                                                    cdkAutosizeMaxRows="5" *ngIf = "i == 0" ></textarea>
                                                                    <mat-error class="error--handing"
                                                                            *ngIf="unit.controls['removalProcess'].hasError('required') && (unit.controls['removalProcess'].dirty || unit.controls['removalProcess'].touched)">
                                                                            {{ "Removal process is required." }}
                                                                        </mat-error>
                                                                    </mat-form-field>
                                                                </div>
                                                            </div>
                                                            <div class="row form-group">
                                                                <div class="col-lg-12">
                                                                    <mat-form-field class="example--full--width mat-headline">
                                                                        <input matInput placeholder="Surgery date" [matDatepicker]="picker" (focus)="picker.open()" formControlName="surgeryDate" name="surgeryDate" *ngIf="i > 0" >
                                                                        <input matInput placeholder="* Surgery date" [matDatepicker]="picker" (focus)="picker.open()" formControlName="surgeryDate" name="surgeryDate" *ngIf="i == 0" >
                                                                        <mat-error class="error--handing"
                                                                            *ngIf="unit.controls['surgeryDate'].hasError('required') && (unit.controls['surgeryDate'].dirty || unit.controls['surgeryDate'].touched)">
                                                                            {{ "Surgery date is required." }}
                                                                        </mat-error>
                                                                        <mat-datepicker-toggle matSuffix [for]="picker"></mat-datepicker-toggle>
                                                                        <mat-datepicker #picker></mat-datepicker>
                                                                    </mat-form-field>
                                                                </div>
                                                            </div>
                                                            <div class="row form-group">
                                                                <div class="col-lg-12">
                                                                    <mat-form-field class="example--full--width mat-headline">
                                                                        <input matInput placeholder="Surgery Location" class="capitalize" formControlName="surgeryLocation" name="surgeryLocation" *ngIf="i > 0" >
                                                                        <input matInput placeholder="* Surgery Location" class="capitalize" formControlName="surgeryLocation" name="surgeryLocation" *ngIf="i == 0" >
                                                                        <mat-error class="error--handing"
                                                                            *ngIf="unit.controls['surgeryLocation'].hasError('required') && (unit.controls['surgeryLocation'].dirty || unit.controls['surgeryLocation'].touched)">
                                                                            {{ "Surgery location is required." }}
                                                                        </mat-error>
                                                                    </mat-form-field>
                                                                </div>
                                                            </div>
                                                        </div>
                                                    </div>
                                                </div>
                                                <div class="add--more mb-1">
                                                    <button type="button" mat-button class="add--more--btn" (click)="addRow();">
                                                        <mat-icon>add_circle_outline</mat-icon>Add More
                                                    </button>
                                                </div>
                                            </div>
                                    </div>
                                <div class="row col-md-12 form--bottom">
                                    <button type="submit" [disabled]="!form.valid || disabledSave" class="btn btn-theme">Save</button>
                                </div>
                            </div>
                            <div class="col-md-3" *ngIf = "croppedImage == ''">
                                <div class="row form-group ">
                                    <div class="col-md-12">
                                      <div  class="implant--image--container cursor--pointer">
                                        <label for="implantImage" class="implant--image--lable"> 
                                            Drop image or click to upload
                                        </label>
                                      </div>
                                      <input type="file" (change)="fileChangeEvent($event)" id="implantImage" accept="image/*" class="form-control" />
                                      <mat-error class="error--handing custome-error" *ngIf= "imageError" >
                                            {{ "Select at least one image to uplaod." }}
                                        </mat-error>
                                        <mat-error class="error--handing custome-error" *ngIf= "imageValidError && !imageError" >
                                            {{ "Only png, jpg, jpeg file allowed." }}
                                        </mat-error>
                                    </div>
                                </div>
                            </div>
                            <div class="col-md-3" *ngIf = "croppedImage != ''">
                                <div class="row form-group ">
                                    <div class="col-md-12">
                                      <div class="implant--image--container cursor--pointer" (click)="openImageAginDemo()">
                                            <mat-icon class="icon--delete" (click)="cansel" >delete_forever</mat-icon>
                                            <img class="previewImg" [src]="croppedImage" />
                                        <!-- <label class="implant--image--lable"> 
                                            Click to upload
                                        </label> -->
                                      </div>
                                      <mat-error class="error--handing custome-error" *ngIf= "imageError" >
                                            {{ "Select at least one image to uplaod." }}
                                        </mat-error>
                                    </div>
                                </div>
                            </div>
                        </div>
                      </form>
                  </div>
              </div>
          </div>
      </div>
  </div>
</div>
